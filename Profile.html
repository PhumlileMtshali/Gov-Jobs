<!DOCTYPE html>
<html lang="en">
<head>
  <title>Profile Section</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="style2.css">
</head>
<body>
<nav aria-label="Primary navigation">
  <div class="nav-inner">
    <a class="logo" href="#"><span class="seal">üèõ</span> Gov Jobs SA</a>
    <div class="nav-links" id="navLinks">
      <a href="index.html" class="nav-link active">Home</a>
      <a href="applications.html" class="nav-link active">Applications</a>
      <a href="jobs.html" class="nav-link active">Jobs</a>
      <a href="profile.html" class="nav-link active">Profile</a>
      <a href="about.html" class="nav-link active">About Us</a>
      <a href="contacts.html" class="nav-link active">Contact Us</a>
    </div>
    <div class="nav-actions">
      <a href="index.html" class="btn primary logout-btn">Logout</a>
    </div>
  </div>
</nav>

<div class="form-header">
  <div class="form-title">
    <h1>MY PROFILE</h1>
  </div>
</div>

<div class="form-container">
  <form id="profileForm">
    <!-- Section A: Personal Information -->
    <section>
      <h3>A. PERSONAL INFORMATION</h3>
      <label>Full Name *:<br><input type="text" name="full_name" required></label>
      <div class="row-3">
        <label>DOB *:<br><input type="date" name="dob" required></label>
        <label>ID Number :<br><input type="text" name="id_number" required></label>
        <label>Passport Number:<br><input type="text" name="passport"></label>
      </div>
      <div class="row-3">
        <label>Race *:<br>
          <select name="race" required>
            <option value="">Select</option>
            <option>African</option>
            <option>White</option>
            <option>Coloured</option>
            <option>Indian</option>
            <option>Other</option>
          </select>
        </label>
        <label>Gender *:<br>
          <select name="gender" required>
            <option value="">Select</option>
            <option>Female</option>
            <option>Male</option>
          </select>
        </label>
        <label>Disability *:<br>
          <select name="disability" required>
            <option value="">Select</option>
            <option>No</option>
            <option>Yes</option>
          </select>
        </label>
      </div>
      <label>South African Citizen? *:<br>
        <select name="sa_citizen" required>
          <option value="">Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>
      </label>
      <label>If No, nationality :<br><input type="text" name="nationality" required></label>
      <label>Valid work permit? *:<br>
        <select name="work_permit" required>
          <option value="">Select</option>
          <option>Yes</option>
          <option>No</option>
        </select>
      </label>

      <!-- Criminal & Employment Details -->
      <label>Criminal Convicted? *:<br>
        <select name="criminal_convicted" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
        <input type="text" name="criminal_details" placeholder="If yes, provide details " required>
      </label>
      <label>Pending criminal case? *:<br>
        <select name="pending_case" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
        <input type="text" name="pending_case_details" placeholder="If yes, provide details " required>
      </label>
      <label>Dismissed for misconduct? *:<br>
        <select name="dismissed_ps" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
        <input type="text" name="dismissal_details" placeholder="If yes, provide details " required>
      </label>
      <label>Pending disciplinary case? *:<br>
        <select name="disciplinary_pending" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
        <input type="text" name="disciplinary_details" placeholder="If yes, provide details " required>
      </label>
      <label>Resigned pending disciplinary? *:<br>
        <select name="resigned_pending" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
      </label>
      <label>Discharged/retired on ill-health? :<br>
        <select name="discharged_ps" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
      </label>
      <label>Business with state? :<br>
        <select name="business_state" required>
          <option value="">Select</option>
          <option>No</option>
          <option>Yes</option>
        </select>
        <input type="text" name="business_details" placeholder="If yes, provide details " required>
      </label>

    <!-- Section B: Contact -->
    <section>
      <h3>B. CONTACT DETAILS</h3>
      <label>Preferred language *:<br><input type="text" name="preferred_language" required></label>
      <label>Correspondence method *:<br>
        <input type="checkbox" name="correspondence_method" value="Post"> Post
        <input type="checkbox" name="correspondence_method" value="Email"> Email
        <input type="checkbox" name="correspondence_method" value="Fax"> Fax
        <input type="checkbox" name="correspondence_method" value="Telephone"> Telephone
      </label>
      <label>Contact info *:<br><input type="text" name="contact_info" required></label>
    </section>

    <!-- Section C: Languages -->
    <section>
      <h3>C. OFFICIAL LANGUAGE PROFICIENCY</h3>
      <div class="language-table">
        <label>Language 1 *:<br><input type="text" name="lang1" required></label>
        <label>Speak *:<br><input type="text" name="speak1" required></label>
        <label>Read/Write *:<br><input type="text" name="read1" required></label>

        <label>Language 2 :<br><input type="text" name="lang2" required></label>
        <label>Speak :<br><input type="text" name="speak2" required></label>
        <label>Read/Write :<br><input type="text" name="read2" required></label>

        <label>Language 3 :<br><input type="text" name="lang3" required></label>
        <label>Speak :<br><input type="text" name="speak3" required></label>
        <label>Read/Write :<br><input type="text" name="read3" required></label>
      </div>
    </section>

    <!-- Section D: Qualifications -->
    <section>
      <h3>D. QUALIFICATIONS</h3>
      <div class="qualification-table">
        <label>School 1 *:<br><input type="text" name="school1" required></label>
        <label>Qualification 1 *:<br><input type="text" name="qual1" required></label>
        <label>Year 1 *:<br><input type="text" name="year1" required></label>

        <label>School 2 :<br><input type="text" name="school2" required></label>
        <label>Qualification 2 :<br><input type="text" name="qual2" required></label>
        <label>Year 2 :<br><input type="text" name="year2" required></label>

        <label>School 3 :<br><input type="text" name="school3" required></label>
        <label>Qualification 3 :<br><input type="text" name="qual3" required></label>
        <label>Year 3 :<br><input type="text" name="year3" required></label>
      </div>
      <label>Current study :<br><input type="text" name="current_study" required></label>
    </section>

    <!-- Section E: Work Experience -->
    <section>
      <h3>E. WORK EXPERIENCE</h3>
      <div class="work-entry">
        <label>Employer 1 :<br><input type="text" name="employer1" required></label>
        <label>Post held 1 :<br><input type="text" name="post1" required></label>
        <label>Reason for leaving 1 :<br><input type="text" name="reason1" required></label>

        <label>Employer 2 :<br><input type="text" name="employer2" required></label>
        <label>Post held 2 :<br><input type="text" name="post2" required></label>
        <label>Reason for leaving 2 :<br><input type="text" name="reason2" required></label>
      </div>

      <!-- Section F: References -->
    <section>
      <h3>F. REFERENCES</h3>
      <div class="reference-table">
        <label>Name 1 :<br><input type="text" name="ref_name1" required></label>
        <label>Relationship 1 :<br><input type="text" name="ref_rel1" required></label>
        <label>Tel 1 :<br><input type="text" name="ref_tel1" required></label>

        <label>Name 2 :<br><input type="text" name="ref_name2" required></label>
        <label>Relationship 2 :<br><input type="text" name="ref_rel2" required></label>
        <label>Tel 2 :<br><input type="text" name="ref_tel2" required></label>
      </div>
    </section>

    <!-- Section G: Supporting Documents -->
    <section>
      <h3>G. SUPPORTING DOCUMENTS</h3>
      <label>Document Type *:<br>
        <select id="docType" required>
          <option value="">Select</option>
          <option value="cv">CV</option>
          <option value="certificate">Certificate</option>
          <option value="id">ID Copy</option>
          <option value="work_permit">Work Permit</option>
          <option value="other">Other</option>
        </select>
      </label>
      <label>Upload Document *:<br><input type="file" id="docUpload" multiple required></label><br>
      <button type="button" onclick="addDocument()">Add Document</button>
      <h5>Uploaded Documents:</h5>
      <ul id="uploadedDocs"></ul>
    </section>

    <!-- Declaration -->
    <section>
      <h3>DECLARATION</h3>
      <label>I declare that all information is correct.</label>
      <label>Signature *:<br><input type="text" name="signature" required></label>
      <label>Date *:<br><input type="date" name="sign_date" required></label>
    </section>

    <div class="form-buttons">
      <button type="button" class="btn save-btn" onclick="submitForm()">Save</button>
    </div>
  </form>
</div>

<footer class="footer">
  <div class="footer-bottom">&copy; 2025 Gov Jobs SA ‚Äî Empowering South African careers in public service.</div>
</footer>

<script>
let uploadedDocs = [];

function addDocument() {
  const files = document.getElementById('docUpload').files;
  const type = document.getElementById('docType').value;
  const list = document.getElementById('uploadedDocs');

  for (let i = 0; i < files.length; i++) {
    uploadedDocs.push({ file: files[i], type: type });
    const li = document.createElement('li');
    li.textContent = `${files[i].name} (${type})`;
    list.appendChild(li);
  }

  document.getElementById('docUpload').value = '';
}

async function submitForm() {
  const form = document.getElementById('profileForm');
  const formData = new FormData();

  Array.from(form.elements).forEach(el => {
    if (!el.name) return;
    if (el.type === "checkbox") {
      if (el.checked) formData.append(el.name, el.value);
    } else {
      formData.append(el.name, el.value.trim());
    }
  });

  // Validation: no empty fields
  for (let [key, value] of formData.entries()) {
    if (!value || value.trim() === "") {
      alert(`Please fill in all fields. If not applicable, write "N/A". Missing: ${key}`);
      return;
    }
  }

  // Append uploaded files
  uploadedDocs.forEach((doc, index) => {
    formData.append(`supporting_docs_${index}`, doc.file);
    formData.append(`doc_type_${index}`, doc.type);
  });

  formData.append('user_id', localStorage.getItem('userId') || 1);

  try {
    const res = await fetch('http://localhost:5000/save-profile', {
      method: 'POST',
      body: formData,
      headers: { "Authorization": `Bearer ${localStorage.getItem("token")}` }
    });
    const result = await res.json();
    if (result.success) alert('Profile saved successfully!');
    else alert('Error saving profile');
  } catch (err) {
    console.error(err);
    alert('Server error');
  }
}

// Lock profile page for logged-in users
if (!localStorage.getItem("token")) {
  alert("Please log in to access your profile");
  window.location.href = "index.html"; 
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="logout.js"></script>
<script src="nav-active.js"></script>
</body>
</html>
